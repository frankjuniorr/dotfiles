# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
#       								~/.git_prompt de Frank
# 			       					Welcome and don't Panic =D
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# [Descrição]:
#
# Arquivo onde fica toda a configuração do prompt
# Deve ser carregado no ~/.bash_aliases
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

# Funções do Prompt
#------------------------------------------------------------------------------

	# imprime as modificações do git
	function git_prompt {
		local git_prompt=""
		local current_branch=""
		local untracked_files=""

		# sefor um diretório git, faça as opeçãoes
		if git status > /dev/null 2>&1;then
			current_branch=$(git branch 2> /dev/null | grep ^* | awk '{print $2}')
			git_prompt=$current_branch

			# verifique se tem "untracked files" (novos arquivos)
			untracked_files=$(git ls-files --others --exclude-standard | wc -l)
			if (( $untracked_files >= 1 ));then
				git_prompt="${git_prompt}${text_yellow}|${text_red}untracked +${untracked_files}"
			else
				git_prompt="$git_prompt"
			fi

			# verifica se tem "modified files"
			modified_files=$(git ls-files --modified | wc -l)
			if (( $modified_files >= 1 ));then
				git_prompt="${git_prompt}${text_yellow}|${text_cyan}modified +$modified_files"
			else
				git_prompt="$git_prompt"
			fi

			# verifica se tem arquivos para ser comitados
			added_files=$(git diff --name-only --cached | wc -l)
			if (( $added_files >= 1 ));then
				git_prompt="${git_prompt}${text_yellow}|${text_green}added +$added_files"
			else
				git_prompt="$git_prompt"
			fi

			# verifica se algo no stash
			stashed_files=$(git stash list | wc -l)
			if (( $stashed_files >= 1 ));then
				git_prompt="${git_prompt}${text_yellow}|${text_yellow}stashed +$stashed_files"
			else
				git_prompt="$git_prompt"
			fi

			echo "${text_yellow}(${git_prompt}${text_yellow})${text_reset}"

		# ... se não for, não imprima nada
		else
			echo "${text_yellow}${git_prompt}${text_reset}"
		fi
 	}

	# Pinta de AZUL se o comando anterior rodou com sucesso
	function parse_erro {
		if [[ $? = "0" ]]; then
			echo "$text_blue"
		# ... se não, pinta de vermelho
		else
			echo "$text_red"
		fi
	}

	# coloca um separador no final do comando
	function separador() {
		string='-'
		repeticoes=$(tput cols)
		valor=$(printf "%-${repeticoes}s" "$string")
		echo "${valor// /-}\n"
	}

# Prompt's
#---------------------------------------------------------------------------------------
# Prompt de Frank
	PROMPT_COMMAND='PS1="$(parse_erro)$(separador)[\W]:$AMARELO$(git_prompt)${text_reset}\n\$ "'

# Prompt de Aurélio Jargas
# PROMPT_COMMAND='__git_ps1 "\033[42;30m\u@\h:\w\033[m" "\n\\\$ "'

# Prompt de Well
	#PROMPT_COMMAND='PS1="\[\033[0;33m\][\!]\`if [[ \$? = "0" ]]; then echo "\\[\\033[32m\\]"; else echo "\\[\\033[31m\\]"; fi\`[\u.\h: \`if [[ `pwd|wc -c|tr -d " "` > 18 ]]; then echo "\\W"; else echo "\\w"; fi\`]\$\[\033[0m\] "; echo -ne "\033]0;`hostname -s`:`pwd`\007"'
